<div class="editor-wrap">
  <div class="left-panel">
    <div class="map-box shadow-effect">
      <xp-map #map 
        [addedCheckpointCollection]="checkpoints" 
        (locationSelected)="onLocationSelected($any($event))"
        (checkpointRemoved)="deleteCheckpoint($any($event))"
        (routeDistanceKm)="onRouteDistanceUpdated($any($event))">
      </xp-map>
    </div>

    <div class="bottom-info-row">
      <div class="info-strip">
        <mat-icon>straighten</mat-icon>
        <span>Total Route Distance: <strong>{{ tourDistanceKm | number:'1.2-2' }} km</strong></span>
      </div>

      <div class="checkpoint-list-left">
        <div class="list-header">
          <div class="title-with-icon">
            <mat-icon>list_alt</mat-icon>
            <h4>Your Itinerary</h4>
          </div>
          <span class="count-badge">{{checkpoints.length}} points</span>
        </div>
        
        <div class="points-horizontal-scroll">
          <div *ngIf="checkpoints.length === 0" class="empty-state-small">
             <p>No points added yet. Click on the map.</p>
          </div>
          <div *ngFor="let cp of checkpoints; let i = index" class="point-chip">
            <span class="index-circle">{{ i + 1 }}</span>
            <span class="point-name">{{ cp.name }}</span>
            <button (click)="deleteCheckpoint(i)" class="btn-delete-small">Ã—</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="right-panel">
    <mat-card class="checkpoint-card glass-effect">
      <div class="card-header">
        <h3 class="card-title">Checkpoint Details</h3>
      </div>
      
      <form [formGroup]="checkpointForm" class="cp-form">
        <div class="input-wrapper">
          <label>Checkpoint Name</label>
          <input formControlName="name" placeholder="Ex. Old Bridge" class="custom-input">
        </div>

        <div class="input-wrapper">
          <label>Description</label>
          <textarea formControlName="description" placeholder="Traveler's info..." rows="3" class="custom-input"></textarea>
        </div>
        
        <div class="coords-display">
          <span class="coord-tag"><mat-icon>my_location</mat-icon> {{ checkpointForm.value.latitude | number:'1.4-4' }}</span>
          <span class="coord-tag"><mat-icon>explore</mat-icon> {{ checkpointForm.value.longitude | number:'1.4-4' }}</span>
        </div>

        <button mat-raised-button class="btn-primary" (click)="addCheckpoint()" [disabled]="!checkpointForm.valid">
          <mat-icon>add_location_alt</mat-icon> Save Position
        </button>
      </form>

      <div class="upload-section">
        <div class="upload-dropzone" (click)="fileInput.click()">
          <mat-icon>cloud_upload</mat-icon>
          <p>Drop image or <span>click to browse</span></p>
          <input type="file" #fileInput accept="image/*" (change)="onFilesSelected($event)" hidden />
        </div>
        
        <div class="previews-container" *ngIf="previews.length">
          <div class="preview-card" *ngFor="let src of previews; let i = index">
            <img [src]="src" />
            <button type="button" class="btn-remove" (click)="removeImage(i)"><mat-icon>close</mat-icon></button>
          </div>
        </div>
      </div>

      <div class="duration-manager">
        <h4>Transport Durations</h4>
        <div class="duration-controls">
          <select class="custom-input small" (change)="onTransportChange(+$any($event.target).value)">
            <option value="0">ðŸš¶ Walking</option>
            <option value="1">ðŸš² Bicycle</option>
            <option value="2">ðŸš— Car</option>
          </select>
          <input type="number" [(ngModel)]="minutes" class="custom-input small" placeholder="Min">
          <button class="btn-add-duration" (click)="addDuration()"><mat-icon>add</mat-icon></button>
        </div>
        <div class="duration-tags">
          <span *ngFor="let d of transportDurations" class="d-tag">
            {{ getTransportIcon(d.transportType) }} {{ d.minutes }}min
          </span>
        </div>
      </div>

      <button mat-raised-button class="btn-finalize" 
              (click)="finalizeTour()" 
              [disabled]="checkpoints.length < 2 || transportDurations.length === 0">
        Publish Tour <mat-icon>publish</mat-icon>
      </button>
    </mat-card>
  </div>
</div>